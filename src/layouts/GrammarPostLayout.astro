---
import Layout from './Layout.astro';
import GrammarSidebar from '../components/grammar/GrammarSidebar.astro';
import PrintStyles from '../components/common/PrintStyles.astro';
import '../styles/global.css';

export interface Props {
  title: string;
  description?: string;
  showTOC?: boolean;
}

const { title, description, showTOC = true } = Astro.props as Props;
---

<Layout title={`${title} - Ngữ pháp tiếng Hàn`} description={description || `Học ngữ pháp ${title} tiếng Hàn miễn phí với The Free Korean.`}>
  <!-- Print-friendly CSS -->
  <PrintStyles />

  <div class="grammar-post-container">
    <!-- Sidebar bên trái -->
    <GrammarSidebar />

    <!-- Nội dung chính -->
    <main class="grammar-main">
      <slot />
    </main>

    <!-- TOC bên phải - slot cho TableOfContents component -->
    {showTOC && (
      <slot name="toc" />
    )}
  </div>
</Layout>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }

  .grammar-post-container {
    display: grid;
    grid-template-columns: 280px 1fr 280px;
    min-height: calc(100vh - 120px);
    gap: 1rem;
    padding: 2rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Khi sidebar thu gọn, thu nhỏ cột trái để main nới rộng */
  .grammar-post-container:has(.grammar-sidebar.collapsed) {
    grid-template-columns: 56px 1fr 280px;
  }

  /* Khi TOC slide-out, thu nhỏ cột phải để main nới rộng */
  .grammar-post-container:has(#toc-container.slide-out),
  .grammar-post-container:has(#toc-container.collapsed) {
    grid-template-columns: 280px 1fr 48px;
  }

  .grammar-main {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 2rem;
  }

  /* Khi một trong hai cột thu gọn, cho nội dung mở rộng hơn */
  .grammar-post-container:has(.grammar-sidebar.collapsed) .grammar-post,
  .grammar-post-container:has(#toc-container.collapsed) .grammar-post {
    max-width: 100%;
  }

  /* Khi cả hai bên đều thu gọn, giảm gap để nội dung tiến gần 2 nút toggle */
  .grammar-post-container:has(.grammar-sidebar.collapsed):has(#toc-container.collapsed) {
    grid-template-columns: 56px 1fr 48px;
    gap: 0.5rem;
  }

  /* Đảm bảo cột giữa co giãn đúng và không bị lệch */
  .grammar-post-container > .grammar-main {
    min-width: 0;
  }

  /* Mobile responsive */
  @media (max-width: 1024px) {
    .grammar-post-container {
      grid-template-columns: 1fr;
      gap: 0;
    }

    .grammar-main {
      padding: 1rem;
    }
  }

  @media (max-width: 768px) {
    .grammar-post-container {
      padding: 0.5rem;
    }

    .grammar-main {
      padding: 1rem;
    }
  }
</style>
