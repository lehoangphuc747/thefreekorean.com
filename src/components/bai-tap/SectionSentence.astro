---
interface WordBuilderConfig {
  targetSentence: string;
  wordPool: string[];
}

interface GuidedWritingConfig {
  id: string;
  title: string;
  prompt: string;
  hint: string;
  answers: string[];
}

interface FreeWritingConfig {
  id: string;
  title: string;
  prompt: string;
}

interface Props {
  wordBuilder: WordBuilderConfig;
  guidedWriting: GuidedWritingConfig;
  freeWriting: FreeWritingConfig;
}

const { wordBuilder, guidedWriting, freeWriting } = Astro.props as Props;
---

<section id="section-4" class="section-content hidden">
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-4">Section 4: Tạo câu (Guided Production)</h2>
    <p class="text-gray-600 mb-6">Tạo câu bằng cách sắp xếp từ hoặc viết câu dựa trên gợi ý.</p>

    <div class="space-y-6 mb-8">
      <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-6 border-2 border-purple-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Bài 1: Xếp từ thành câu</h3>
        <p class="text-gray-700 mb-4">
          Chọn từ để tạo câu: <strong>{wordBuilder.targetSentence}</strong>
        </p>
        <div class="flex flex-wrap gap-2 mb-4" id="word-pool-1">
          {wordBuilder.wordPool.map((word) => (
            <button
              onclick={`addWordToSentence(1, '${word}', this)`}
              class="word-card px-4 py-2 bg-white border-2 border-gray-300 rounded-lg hover:border-blue-400 cursor-pointer text-gray-900"
              data-word={word}
            >
              {word}
            </button>
          ))}
        </div>
        <div class="bg-white rounded-lg p-4 min-h-[60px] border-2 border-dashed border-gray-300 mb-4" id="sentence-area-1"></div>
        <button onclick={`checkSentence(1, '${wordBuilder.targetSentence}')`} class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
          Kiểm tra
        </button>
        <div class="answer-feedback mt-4 hidden" id="feedback-1"></div>
      </div>

      <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-6 border-2 border-blue-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">{guidedWriting.title}</h3>
        <p class="text-gray-700 mb-2">
          Gợi ý: <strong>{guidedWriting.prompt}</strong>
        </p>
        <p class="text-sm text-gray-500 mb-4 italic">{guidedWriting.hint}</p>
        <textarea
          name={guidedWriting.id}
          placeholder="Viết câu tiếng Hàn..."
          class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4 min-h-[80px] text-gray-900"
        ></textarea>
        <button
          data-answers={guidedWriting.answers.join('|')}
          onclick={`checkWrittenSentence('${guidedWriting.id}', this.dataset.answers)`}
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          Kiểm tra
        </button>
        <div class="answer-feedback mt-4 hidden" id={`feedback-${guidedWriting.id}`}></div>
      </div>

      <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-6 border-2 border-green-200">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">{freeWriting.title}</h3>
        <p class="text-gray-700 mb-4">{freeWriting.prompt}</p>
        <textarea
          name={freeWriting.id}
          placeholder="Viết câu tiếng Hàn..."
          class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none mb-4 min-h-[80px] text-gray-900"
        ></textarea>
        <button onclick={`checkFreeSentence('${freeWriting.id}')`} class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
          Kiểm tra
        </button>
        <div class="answer-feedback mt-4 hidden" id={`feedback-${freeWriting.id}`}></div>
      </div>
    </div>

    <div class="mt-6 pt-6 border-t">
      <button onclick="completeSection(4)" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium">
        Hoàn thành Section 4 → Mở Mini Test
      </button>
    </div>
  </div>
</section>

