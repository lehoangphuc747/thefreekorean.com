---
export interface DialogueExample {
  q_ko: string;
  q_vi: string;
  a_ko: string;
  a_vi: string;
}

export interface SentenceExample {
  ko: string;
  vi: string;
}

export interface Props {
  title: string;
  dialogueSection: {
    subtitle: string;
    examples: DialogueExample[];
  };
  sentenceSection: {
    subtitle: string;
    examples: SentenceExample[];
  };
  note: {
    subtitle: string;
    content_vi: string;
  };
}

const { title, dialogueSection, sentenceSection, note } = Astro.props;

// Hàm để highlight ngữ pháp
const highlightGrammar = (text: string, customPatterns: string[] = []) => {
  const defaultPatterns = ['으면서', '면서', '으며', '고', '걸으면서', '부드러우면서', '지으면서', '하야면서'];
  const allPatterns = [...defaultPatterns, ...customPatterns];
  const regex = new RegExp(`(${allPatterns.join('|')})`, 'g');
  
  if (!text) return text;
  
  return text.replace(regex, '<strong class="text-purple-600 font-bold">$1</strong>');
};
---

<div class="bg-white rounded-3xl shadow-lg p-8 max-w-sm md:max-w-3xl w-full">
  <h2 class="text-2xl font-bold text-slate-800 mb-6">{title}</h2>
  <div class="space-y-6">
    <div>
      <div class="flex items-center justify-between gap-3 mb-3 text-slate-800">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
          </svg>
          <h3 class="text-lg font-semibold">{dialogueSection.subtitle}</h3>
        </div>
        <div class="flex items-center gap-1 text-xs font-semibold text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m4 13l4-4-4-4M19 17v-2a4 4 0 00-4-4H9" />
          </svg>
          <span>Bấm để dịch</span>
        </div>
      </div>
      <div class="space-y-2 divide-y divide-slate-200">
        {dialogueSection.examples.map((ex) => (
          <div class="dialogue-item text-sm font-medium cursor-pointer py-2 px-2 -mx-2 rounded-lg transition-colors hover:bg-slate-100">
            <p>
              <span class="font-bold text-blue-600">A: </span>
              <Fragment set:html={highlightGrammar(ex.q_ko)} />
            </p>
            <p class="translation hidden text-blue-500 italic pl-5">{ex.q_vi}</p>
            <p class="mt-1">
              <span class="font-bold text-red-600">B: </span>
              <Fragment set:html={highlightGrammar(ex.a_ko)} />
            </p>
            <p class="translation hidden text-red-500 italic pl-5">{ex.a_vi}</p>
          </div>
        ))}
      </div>
    </div>
    
    <div>
      <div class="flex items-center justify-between gap-3 mb-3 text-slate-800">
        <div class="flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
          </svg>
          <h3 class="text-lg font-semibold">{sentenceSection.subtitle}</h3>
        </div>
        <div class="flex items-center gap-1 text-xs font-semibold text-slate-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m4 13l4-4-4-4M19 17v-2a4 4 0 00-4-4H9" />
          </svg>
          <span>Bấm để dịch</span>
        </div>
      </div>
      <ul class="space-y-1 divide-y divide-slate-200">
        {sentenceSection.examples.map((ex) => (
          <li class="sentence-item text-sm font-medium text-slate-700 cursor-pointer py-1 px-2 -mx-2 rounded-lg transition-colors hover:bg-slate-100">
            <Fragment set:html={highlightGrammar(ex.ko)} />
            <p class="translation hidden text-slate-500 italic pl-4">{ex.vi}</p>
          </li>
        ))}
      </ul>
    </div>
    
    <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
      <div class="flex items-center gap-3 mb-2 text-blue-800">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="text-base font-semibold">{note.subtitle}</h3>
      </div>
      <p class="text-slate-600 font-medium leading-relaxed">{note.content_vi}</p>
    </div>
  </div>
</div>

<script>
// JavaScript cho chức năng toggle translation
document.addEventListener('DOMContentLoaded', function() {
  // Toggle cho dialogue items
  document.querySelectorAll('.dialogue-item').forEach(item => {
    item.addEventListener('click', function() {
      const translations = this.querySelectorAll('.translation');
      translations.forEach(translation => {
        translation.classList.toggle('hidden');
      });
    });
  });

  // Toggle cho sentence items
  document.querySelectorAll('.sentence-item').forEach(item => {
    item.addEventListener('click', function() {
      const translation = this.querySelector('.translation');
      if (translation) {
        translation.classList.toggle('hidden');
      }
    });
  });
});
</script>
