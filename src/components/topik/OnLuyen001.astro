---
// Component: OnLuyen001 - hi·ªÉn th·ªã danh s√°ch m·ª•c √¥n luy·ªán (d·ªãch nghƒ©a) theo section
// Data ƒë·∫ßu v√†o: sections: { title: string, note?: string, items: { prompt: string, answer: string }[] }[]
// H√†nh vi: ng∆∞·ªùi d√πng nh·∫≠p b·∫£n d·ªãch v√† nh·∫•n Enter ƒë·ªÉ HI·ªÜN ƒë√°p √°n (kh√¥ng ch·∫•m ƒëi·ªÉm)
// T·ªëi ∆∞u cho m·ªü r·ªông: h·ªó tr·ª£ 30-50 ng·ªØ ph√°p, m·ªói ng·ªØ ph√°p 5 c√¢u = 150-250 c√¢u

export interface OnLuyenItem {
	prompt: string;   // c√¢u ti·∫øng H√†n ho·∫∑c n·ªôi dung c·∫ßn d·ªãch
	answer: string;   // g·ª£i √Ω ƒë√°p √°n ti·∫øng Vi·ªát
}

export interface OnLuyenSection {
	title: string;          // ti√™u ƒë·ªÅ section, v√≠ d·ª•: "Ng·ªØ ph√°p -Îã§Í∞Ä : __________"
	note?: string;          // ch√∫ th√≠ch ng·∫Øn, v√≠ d·ª•: "ƒêang... th√¨ (chuy·ªÉn ƒë·ªïi h√†nh ƒë·ªông)"
	items: OnLuyenItem[];   // danh s√°ch c√¢u h·ªèi
}

export interface OnLuyenFunctionalGroup {
	groupTitle: string;
	description?: string;
	sections: OnLuyenSection[];
}

export interface OnLuyenCategory {
	categoryTitle: string;
	functionalGroups: OnLuyenFunctionalGroup[];
}

export interface Props {
	sections?: OnLuyenSection[];  // C·∫•u tr√∫c c≈©: sections tr·ª±c ti·∫øp
	categories?: OnLuyenCategory[]; // C·∫•u tr√∫c m·ªõi: categories v·ªõi categoryTitle
}

const { sections = [], categories = [] } = Astro.props as Props;

// N·∫øu c√≥ categories, flatten th√†nh sections nh∆∞ng gi·ªØ th√¥ng tin category
let allSections: (OnLuyenSection & { categoryTitle?: string; groupTitle?: string })[] = [];
let categoryMap: Map<number, string> = new Map(); // Map section index -> categoryTitle

if (categories.length > 0) {
	// C·∫•u tr√∫c m·ªõi v·ªõi categories
	let sectionIdx = 0;
	categories.forEach((category) => {
		category.functionalGroups.forEach((group) => {
			group.sections.forEach((section) => {
				allSections.push({
					...section,
					categoryTitle: category.categoryTitle,
					groupTitle: group.groupTitle
				});
				categoryMap.set(sectionIdx, category.categoryTitle);
				sectionIdx++;
			});
		});
	});
} else if (sections.length > 0) {
	// C·∫•u tr√∫c c≈© v·ªõi sections tr·ª±c ti·∫øp
	allSections = sections;
}

const hasManySections = allSections.length >= 5;
const totalItems = allSections.reduce((sum, s) => sum + (s.items?.length || 0), 0);

// Nh√≥m sections theo category
const sectionsByCategory: Map<string, typeof allSections> = new Map();
allSections.forEach((section) => {
	const catTitle = section.categoryTitle || 'Kh√°c';
	if (!sectionsByCategory.has(catTitle)) {
		sectionsByCategory.set(catTitle, []);
	}
	sectionsByCategory.get(catTitle)!.push(section);
});
---

<div class="onluyen-ctn">
	{allSections.length === 0 ? (
		<div class="ol-empty-state">
			Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y truy·ªÅn props <code>sections</code> ho·∫∑c <code>categories</code> v√†o component.
		</div>
	) : (
		<>
			<!-- Table of Contents - hi·ªÉn th·ªã khi c√≥ nhi·ªÅu sections -->
			{hasManySections && (
				<nav class="ol-toc">
					<div class="ol-toc-header">
						<span class="ol-toc-title">M·ª•c l·ª•c</span>
						<span class="ol-toc-count">{allSections.length} ng·ªØ ph√°p ¬∑ {totalItems} c√¢u</span>
					</div>
					{sectionsByCategory.size > 1 ? (
						Array.from(sectionsByCategory.entries()).map(([catTitle, catSections]) => {
							const catType = catTitle.includes('Ïó∞Í≤∞Ïñ¥ÎØ∏') ? 'connecting' : catTitle.includes('Ï¢ÖÍ≤∞Ïñ¥ÎØ∏') ? 'ending' : 'default';
							return (
								<div class={`ol-toc-category ol-toc-category-${catType}`}>
									<div class="ol-toc-category-title">{catTitle}</div>
									<ul class="ol-toc-list">
										{catSections.map((section) => {
											const globalIdx = allSections.indexOf(section);
											return (
												<li>
													<a 
														href={`#section-${globalIdx}`} 
														class="ol-toc-link"
														data-section-index={globalIdx}
													>
														<span class="ol-toc-number">{globalIdx + 1}</span>
														<span class="ol-toc-text">{section.title}</span>
														<span class="ol-toc-items">{section.items?.length || 0} c√¢u</span>
													</a>
												</li>
											);
										})}
									</ul>
								</div>
							);
						})
					) : (
						<ul class="ol-toc-list">
							{allSections.map((section, idx) => (
								<li>
									<a 
										href={`#section-${idx}`} 
										class="ol-toc-link"
										data-section-index={idx}
									>
										<span class="ol-toc-number">{idx + 1}</span>
										<span class="ol-toc-text">{section.title}</span>
										<span class="ol-toc-items">{section.items?.length || 0} c√¢u</span>
									</a>
								</li>
							))}
						</ul>
					)}
				</nav>
			)}

			<!-- Categories v√† Sections -->
			<div class="ol-sections">
				{sectionsByCategory.size > 1 ? (
					Array.from(sectionsByCategory.entries()).map(([catTitle, catSections]) => {
						const catType = catTitle.includes('Ïó∞Í≤∞Ïñ¥ÎØ∏') ? 'connecting' : catTitle.includes('Ï¢ÖÍ≤∞Ïñ¥ÎØ∏') ? 'ending' : 'default';
						return (
							<div class={`ol-category ol-category-${catType}`}>
								<div class="ol-category-header">
									<h2 class="ol-category-title">{catTitle}</h2>
									<span class="ol-category-count">{catSections.length} ng·ªØ ph√°p</span>
								</div>
								<div class="ol-category-sections">
									{catSections.map((section) => {
										const globalIdx = allSections.indexOf(section);
										return (
											<section 
												id={`section-${globalIdx}`} 
												class="ol-section"
												data-section-index={globalIdx}
											>
												<!-- Section Header (sticky khi scroll) -->
												<header class="ol-section-header">
													<button 
														type="button" 
														class="ol-section-toggle"
														aria-expanded="true"
														data-section-toggle={globalIdx}
													>
														<span class="ol-section-number">{globalIdx + 1}</span>
														<h2 class="ol-section-title">{section.title}</h2>
														<span class="ol-section-count">{section.items?.length || 0} c√¢u</span>
														<svg class="ol-section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
														</svg>
													</button>
												</header>

												<!-- Section Content (c√≥ th·ªÉ collapse) -->
												<div class="ol-section-content" data-section-content={globalIdx}>
													<!-- √î nh·∫≠p √Ω nghƒ©a/ƒë·ªãnh nghƒ©a c·ªßa ng·ªØ ph√°p (note) -->
													<div class="ol-note-card">
														<div class="ol-note-icon">üí°</div>
														<div class="ol-note-content">
															<label class="ol-note-label">√ù nghƒ©a / ƒë·ªãnh nghƒ©a</label>
															<div class="ol-note-input-wrap">
																<input 
																	class="ol-note-input" 
																	placeholder="Ghi ch√∫ √Ω nghƒ©a ng·∫Øn g·ªçn... (nh·∫•n Enter ho·∫∑c b·∫•m Hi·ªán g·ª£i √Ω)" 
																	spellcheck="false"
																	data-note-input={globalIdx}
																/>
																{section.note && (
																	<button 
																		type="button" 
																		class="ol-note-btn"
																		data-note-btn={globalIdx}
																	>
																		Hi·ªán g·ª£i √Ω
																	</button>
																)}
															</div>

															{section.note && (
																<div class="ol-note-ans hidden" data-note-ans={globalIdx}>
																	<div class="ol-ans-label">G·ª£i √Ω:</div>
																	<div class="ol-ans-box ol-ans-note">
																		{section.note}
																	</div>
																</div>
															)}
														</div>
													</div>

													<div class="ol-instruction">
														Nh·∫≠p b·∫£n d·ªãch ti·∫øng Vi·ªát cho t·ª´ng c√¢u, nh·∫•n Enter ho·∫∑c b·∫•m "Hi·ªán ƒë√°p √°n" ƒë·ªÉ xem g·ª£i √Ω.
													</div>

													<div class="ol-items">
														{section.items.map((it, idx) => (
															<div class="ol-item">
																<div class="ol-item-head">
																	<span class="ol-item-index">C√¢u {idx + 1}</span>
																	<div class="ol-item-prompt">{it.prompt}</div>
																</div>

																<div class="ol-item-body">
																	<textarea 
																		class="ol-input" 
																		rows="2" 
																		placeholder="‚úçÔ∏è Vi·∫øt b·∫£n d·ªãch ti·∫øng Vi·ªát c·ªßa b·∫°n t·∫°i ƒë√¢y..." 
																		spellcheck="false"
																		data-item-input={`${globalIdx}-${idx}`}
																	></textarea>
																	<div class="ol-actions">
																		<button 
																			type="button" 
																			class="ol-show-btn"
																			data-item-btn={`${globalIdx}-${idx}`}
																		>
																			Hi·ªán ƒë√°p √°n
																		</button>
																		<span class="ol-hint">Nh·∫•n Enter ƒë·ªÉ hi·ªán ƒë√°p √°n</span>
																	</div>
																</div>

																<div class="ol-ans hidden" data-item-ans={`${globalIdx}-${idx}`}>
																	<div class="ol-ans-label">G·ª£i √Ω:</div>
																	<div class="ol-ans-box">
																		{it.answer}
																	</div>
																</div>
															</div>
														))}
													</div>
												</div>
											</section>
										);
									})}
								</div>
							</div>
						);
					})
				) : (
					allSections.map((section, sIdx) => (
					<section 
						id={`section-${sIdx}`} 
						class="ol-section"
						data-section-index={sIdx}
					>
						<!-- Section Header (sticky khi scroll) -->
						<header class="ol-section-header">
							<button 
								type="button" 
								class="ol-section-toggle"
								aria-expanded="true"
								data-section-toggle={sIdx}
							>
								<span class="ol-section-number">{sIdx + 1}</span>
								<h2 class="ol-section-title">{section.title}</h2>
								<span class="ol-section-count">{section.items?.length || 0} c√¢u</span>
								<svg class="ol-section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
								</svg>
							</button>
						</header>

						<!-- Section Content (c√≥ th·ªÉ collapse) -->
						<div class="ol-section-content" data-section-content={sIdx}>
							<!-- √î nh·∫≠p √Ω nghƒ©a/ƒë·ªãnh nghƒ©a c·ªßa ng·ªØ ph√°p (note) -->
							<div class="ol-note-card">
								<div class="ol-note-icon">üí°</div>
								<div class="ol-note-content">
									<label class="ol-note-label">√ù nghƒ©a / ƒë·ªãnh nghƒ©a</label>
									<div class="ol-note-input-wrap">
										<input 
											class="ol-note-input" 
											placeholder="Ghi ch√∫ √Ω nghƒ©a ng·∫Øn g·ªçn... (nh·∫•n Enter ho·∫∑c b·∫•m Hi·ªán g·ª£i √Ω)" 
											spellcheck="false"
											data-note-input={sIdx}
										/>
										{section.note && (
											<button 
												type="button" 
												class="ol-note-btn"
												data-note-btn={sIdx}
											>
												Hi·ªán g·ª£i √Ω
											</button>
										)}
									</div>

									{section.note && (
										<div class="ol-note-ans hidden" data-note-ans={sIdx}>
											<div class="ol-ans-label">G·ª£i √Ω:</div>
											<div class="ol-ans-box ol-ans-note">
												{section.note}
											</div>
										</div>
									)}
								</div>
							</div>

							<div class="ol-instruction">
								Nh·∫≠p b·∫£n d·ªãch ti·∫øng Vi·ªát cho t·ª´ng c√¢u, nh·∫•n Enter ho·∫∑c b·∫•m "Hi·ªán ƒë√°p √°n" ƒë·ªÉ xem g·ª£i √Ω.
							</div>

							<div class="ol-items">
								{section.items.map((it, idx) => (
									<div class="ol-item">
										<div class="ol-item-head">
											<span class="ol-item-index">C√¢u {idx + 1}</span>
											<div class="ol-item-prompt">{it.prompt}</div>
										</div>

										<div class="ol-item-body">
											<textarea 
												class="ol-input" 
												rows="2" 
												placeholder="‚úçÔ∏è Vi·∫øt b·∫£n d·ªãch ti·∫øng Vi·ªát c·ªßa b·∫°n t·∫°i ƒë√¢y..." 
												spellcheck="false"
												data-item-input={`${sIdx}-${idx}`}
											></textarea>
											<div class="ol-actions">
												<button 
													type="button" 
													class="ol-show-btn"
													data-item-btn={`${sIdx}-${idx}`}
												>
													Hi·ªán ƒë√°p √°n
												</button>
												<span class="ol-hint">Nh·∫•n Enter ƒë·ªÉ hi·ªán ƒë√°p √°n</span>
											</div>
										</div>

										<div class="ol-ans hidden" data-item-ans={`${sIdx}-${idx}`}>
											<div class="ol-ans-label">G·ª£i √Ω:</div>
											<div class="ol-ans-box">
												{it.answer}
											</div>
										</div>
									</div>
								))}
							</div>
						</div>
					</section>
				))}
			</div>
		</>
	)}
</div>

<script is:inline>
	document.addEventListener('DOMContentLoaded', () => {
		// X·ª≠ l√Ω hi·ªÉn th·ªã ƒë√°p √°n cho t·ª´ng c√¢u
		document.querySelectorAll('[data-item-input]').forEach((textarea) => {
			const key = textarea.getAttribute('data-item-input');
			const answer = document.querySelector(`[data-item-ans="${key}"]`);
			const btn = document.querySelector(`[data-item-btn="${key}"]`);

			if (textarea && answer) {
				textarea.addEventListener('keydown', (e) => {
					const keyEvent = e;
					if (keyEvent.key === 'Enter' && !keyEvent.shiftKey) {
						keyEvent.preventDefault();
						answer.classList.remove('hidden');
						if (btn) btn.classList.add('is-open');
					}
				});
			}

			if (btn && answer) {
				btn.addEventListener('click', () => {
					answer.classList.remove('hidden');
					btn.classList.add('is-open');
				});
			}
		});

		// X·ª≠ l√Ω √¥ nh·∫≠p note
		document.querySelectorAll('[data-note-input]').forEach((input) => {
			const key = input.getAttribute('data-note-input');
			const answer = document.querySelector(`[data-note-ans="${key}"]`);
			const btn = document.querySelector(`[data-note-btn="${key}"]`);

			if (input && answer) {
				input.addEventListener('keydown', (e) => {
					const keyEvent = e;
					if (keyEvent.key === 'Enter') {
						keyEvent.preventDefault();
						answer.classList.remove('hidden');
					}
				});
			}

			if (btn && answer) {
				btn.addEventListener('click', () => {
					answer.classList.remove('hidden');
					btn.classList.add('is-open');
				});
			}
		});

		// X·ª≠ l√Ω collapse/expand sections
		document.querySelectorAll('[data-section-toggle]').forEach((toggle) => {
			const sectionIdx = toggle.getAttribute('data-section-toggle');
			const content = document.querySelector(`[data-section-content="${sectionIdx}"]`);
			
			if (!content || !(content instanceof HTMLElement)) return;

			// Set initial height ƒë·ªÉ sections m·ªü m·∫∑c ƒë·ªãnh
			content.style.maxHeight = content.scrollHeight + 'px';

			toggle.addEventListener('click', () => {
				const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
				toggle.setAttribute('aria-expanded', String(!isExpanded));
				
				if (isExpanded) {
					// Collapse: thu nh·ªè
					const currentHeight = content.scrollHeight;
					content.style.maxHeight = currentHeight + 'px';
					// Force reflow
					void content.offsetHeight;
					// Collapse
					requestAnimationFrame(() => {
						content.style.maxHeight = '0px';
						content.classList.add('is-collapsed');
					});
				} else {
					// Expand: m·ªü r·ªông
					content.classList.remove('is-collapsed');
					// T√≠nh l·∫°i height (c√≥ th·ªÉ ƒë√£ thay ƒë·ªïi do answer ƒë∆∞·ª£c hi·ªÉn th·ªã)
					const targetHeight = content.scrollHeight;
					content.style.maxHeight = '0px';
					// Force reflow
					void content.offsetHeight;
					// Expand
					requestAnimationFrame(() => {
						content.style.maxHeight = targetHeight + 'px';
						// Sau khi animation xong, set m·ªôt gi√° tr·ªã l·ªõn ƒë·ªÉ cho ph√©p n·ªôi dung m·ªü r·ªông
						setTimeout(() => {
							if (!content.classList.contains('is-collapsed')) {
								content.style.maxHeight = '99999px';
							}
						}, 450);
					});
				}
				
				toggle.classList.toggle('is-collapsed', isExpanded);
			});
		});

		// Smooth scroll cho TOC links
		document.querySelectorAll('.ol-toc-link').forEach((link) => {
			link.addEventListener('click', (e) => {
				e.preventDefault();
				const href = link.getAttribute('href');
				if (href) {
					const target = document.querySelector(href);
					if (target) {
						target.scrollIntoView({ behavior: 'smooth', block: 'start' });
						// Expand section n·∫øu ƒëang collapsed
						const sectionIdx = link.getAttribute('data-section-index');
						const toggle = document.querySelector(`[data-section-toggle="${sectionIdx}"]`);
						const content = document.querySelector(`[data-section-content="${sectionIdx}"]`);
						if (toggle && content && toggle.getAttribute('aria-expanded') === 'false') {
							toggle.setAttribute('aria-expanded', 'true');
							content.classList.remove('is-collapsed');
							toggle.classList.remove('is-collapsed');
						}
					}
				}
			});
		});

		// Highlight section khi scroll (cho TOC)
		if (document.querySelector('.ol-toc')) {
			const sections = document.querySelectorAll('.ol-section');
			const observer = new IntersectionObserver(
				(entries) => {
					entries.forEach((entry) => {
						if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
							const sectionIdx = entry.target.getAttribute('data-section-index');
							document.querySelectorAll('.ol-toc-link').forEach((link) => {
								link.classList.toggle('is-active', link.getAttribute('data-section-index') === sectionIdx);
							});
						}
					});
				},
				{ threshold: [0.3, 0.5, 0.7] }
			);
			sections.forEach((section) => observer.observe(section));
		}
	});
</script>

<style>
	/* Container */
	.onluyen-ctn {
		max-width: 48rem;
		margin: 0 auto;
	}

	/* Empty State */
	.ol-empty-state {
		padding: 1.5rem;
		background: #fef3c7;
		border: 2px solid #fcd34d;
		border-radius: 0.5rem;
		color: #78350f;
	}

	.ol-empty-state code {
		background: white;
		padding: 0.125rem 0.375rem;
		border-radius: 0.25rem;
		border: 1px solid #fbbf24;
		font-size: 0.875rem;
	}

	/* Table of Contents */
	.ol-toc {
		margin-bottom: 2rem;
		padding: 1rem;
		background: #f8fafc;
		border: 2px solid #e2e8f0;
		border-radius: 0.5rem;
	}

	.ol-toc-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 0.75rem;
		padding-bottom: 0.75rem;
		border-bottom: 1px solid #cbd5e1;
	}

	.ol-toc-title {
		font-weight: 700;
		font-size: 1.125rem;
		color: #0f172a;
	}

	.ol-toc-count {
		font-size: 0.875rem;
		color: #64748b;
	}

	.ol-toc-list {
		list-style: none;
		margin: 0;
		padding: 0;
		display: grid;
		gap: 0.5rem;
	}

	.ol-toc-link {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 0.625rem 0.75rem;
		border-radius: 0.375rem;
		border: 1px solid transparent;
		background: white;
		color: #334155;
		text-decoration: none;
		transition: all 0.2s ease;
	}

	.ol-toc-link:hover {
		background: #f1f5f9;
		border-color: #cbd5e1;
	}

	.ol-toc-link.is-active {
		background: #dbeafe;
		border-color: #3b82f6;
		color: #1e40af;
		font-weight: 600;
	}

	.ol-toc-number {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 1.5rem;
		height: 1.5rem;
		border-radius: 9999px;
		background: #e2e8f0;
		color: #475569;
		font-size: 0.75rem;
		font-weight: 600;
		flex-shrink: 0;
	}

	.ol-toc-link.is-active .ol-toc-number {
		background: #3b82f6;
		color: white;
	}

	.ol-toc-text {
		flex: 1;
		font-size: 0.875rem;
	}

	.ol-toc-items {
		font-size: 0.75rem;
		color: #94a3b8;
		flex-shrink: 0;
	}

	.ol-toc-category {
		margin-bottom: 1rem;
	}

	.ol-toc-category:last-child {
		margin-bottom: 0;
	}

	.ol-toc-category-title {
		font-size: 0.875rem;
		font-weight: 700;
		color: #1e40af;
		margin-bottom: 0.5rem;
		padding: 0.5rem 0.75rem;
		background: #dbeafe;
		border-radius: 0.375rem;
		border-left: 3px solid #3b82f6;
	}

	.ol-toc-category-ending .ol-toc-category-title {
		color: #047857;
		background: #d1fae5;
		border-left-color: #10b981;
	}

	/* Sections Container */
	.ol-sections {
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	/* Category */
	.ol-category {
		border: 2px solid #e2e8f0;
		border-radius: 0.75rem;
		background: #fafafa;
		padding: 0;
		overflow: hidden;
	}

	.ol-category-connecting {
		border-color: #3b82f6;
		background: linear-gradient(to bottom, #eff6ff 0%, #fafafa 3%);
	}

	.ol-category-ending {
		border-color: #10b981;
		background: linear-gradient(to bottom, #ecfdf5 0%, #fafafa 3%);
	}

	.ol-category-header {
		padding: 1.5rem 1.5rem 1rem;
		background: transparent;
		border-bottom: 2px solid #e2e8f0;
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 1rem;
	}

	.ol-category-connecting .ol-category-header {
		border-bottom-color: #3b82f6;
		background: linear-gradient(to bottom, #dbeafe, #eff6ff);
	}

	.ol-category-ending .ol-category-header {
		border-bottom-color: #10b981;
		background: linear-gradient(to bottom, #d1fae5, #ecfdf5);
	}

	.ol-category-title {
		font-size: 1.5rem;
		font-weight: 800;
		color: #0f172a;
		margin: 0;
		line-height: 1.2;
	}

	.ol-category-connecting .ol-category-title {
		color: #1e40af;
	}

	.ol-category-ending .ol-category-title {
		color: #047857;
	}

	.ol-category-count {
		font-size: 0.875rem;
		color: #64748b;
		padding: 0.375rem 0.75rem;
		background: white;
		border-radius: 9999px;
		border: 1px solid #cbd5e1;
		font-weight: 600;
		white-space: nowrap;
	}

	.ol-category-sections {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
		padding: 1.5rem;
	}

	/* Section */
	.ol-section {
		border: 2px solid #e2e8f0;
		border-radius: 0.5rem;
		background: white;
		overflow: hidden;
	}

	/* Section Header - Sticky */
	.ol-section-header {
		position: sticky;
		top: 0;
		z-index: 10;
		background: white;
		border-bottom: 2px solid #e2e8f0;
	}

	.ol-section-toggle {
		width: 100%;
		display: flex;
		align-items: center;
		gap: 0.75rem;
		padding: 1rem 1.25rem;
		background: transparent;
		border: none;
		cursor: pointer;
		text-align: left;
		transition: background 0.2s ease;
	}

	.ol-section-toggle:hover {
		background: #f8fafc;
	}

	.ol-section-number {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 2rem;
		height: 2rem;
		border-radius: 9999px;
		background: #3b82f6;
		color: white;
		font-weight: 700;
		font-size: 0.875rem;
		flex-shrink: 0;
	}

	.ol-section-title {
		flex: 1;
		font-size: 1.125rem;
		font-weight: 700;
		color: #0f172a;
		margin: 0;
	}

	.ol-section-count {
		font-size: 0.875rem;
		color: #64748b;
		padding: 0.25rem 0.625rem;
		background: #f1f5f9;
		border-radius: 9999px;
		flex-shrink: 0;
	}

	.ol-section-icon {
		width: 1.25rem;
		height: 1.25rem;
		color: #64748b;
		transition: transform 0.2s ease;
		flex-shrink: 0;
	}

	.ol-section-toggle.is-collapsed .ol-section-icon {
		transform: rotate(-90deg);
	}

	/* Section Content */
	.ol-section-content {
		padding: 1.25rem;
		overflow: hidden;
		transition: max-height 0.4s ease, opacity 0.3s ease, padding 0.3s ease;
		opacity: 1;
	}

	.ol-section-content.is-collapsed {
		opacity: 0;
		padding-top: 0;
		padding-bottom: 0;
	}

	/* Note Card */
	.ol-note-card {
		display: flex;
		gap: 0.75rem;
		padding: 1rem;
		border: 2px solid #bfdbfe;
		border-radius: 0.5rem;
		background: #eff6ff;
		margin-bottom: 1rem;
		align-items: flex-start;
	}

	.ol-note-icon {
		font-size: 1.5rem;
		line-height: 1;
		flex-shrink: 0;
	}

	.ol-note-content {
		flex: 1;
		min-width: 0;
	}

	.ol-note-label {
		display: block;
		font-weight: 600;
		font-size: 0.875rem;
		color: #1e40af;
		margin-bottom: 0.5rem;
	}

	.ol-note-input-wrap {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		align-items: center;
	}

	.ol-note-input {
		flex: 1;
		min-width: min(280px, 100%);
		padding: 0.5rem 0.75rem;
		border: 2px solid #bfdbfe;
		border-radius: 0.375rem;
		background: white;
		font-size: 0.875rem;
		transition: border-color 0.2s ease;
	}

	.ol-note-input:focus {
		outline: none;
		border-color: #3b82f6;
	}

	.ol-note-btn {
		padding: 0.5rem 0.875rem;
		border-radius: 0.375rem;
		background: #3b82f6;
		color: white;
		font-size: 0.875rem;
		font-weight: 600;
		border: 2px solid #3b82f6;
		cursor: pointer;
		transition: background 0.2s ease, border-color 0.2s ease;
	}

	.ol-note-btn:hover {
		background: #2563eb;
		border-color: #2563eb;
	}

	.ol-note-btn.is-open {
		background: #1e40af;
		border-color: #1e40af;
	}

	.ol-note-ans {
		margin-top: 0.75rem;
	}

	/* Instruction */
	.ol-instruction {
		font-size: 0.875rem;
		color: #64748b;
		margin-bottom: 1rem;
		padding: 0.75rem;
		background: #f8fafc;
		border-radius: 0.375rem;
		border: 1px solid #e2e8f0;
	}

	/* Items Container */
	.ol-items {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	/* Item */
	.ol-item {
		padding: 1rem;
		border: 2px solid #e2e8f0;
		border-radius: 0.5rem;
		background: #fafafa;
		transition: border-color 0.2s ease, background 0.2s ease;
	}

	.ol-item:hover {
		border-color: #cbd5e1;
		background: white;
	}

	.ol-item-head {
		margin-bottom: 0.75rem;
	}

	.ol-item-index {
		display: inline-flex;
		align-items: center;
		padding: 0.25rem 0.625rem;
		border-radius: 9999px;
		background: #dbeafe;
		color: #1e40af;
		font-weight: 600;
		font-size: 0.75rem;
		margin-bottom: 0.5rem;
	}

	.ol-item-prompt {
		font-size: 0.9375rem;
		color: #0f172a;
		line-height: 1.6;
	}

	.ol-item-body {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
	}

	.ol-input {
		width: 100%;
		border-radius: 0.375rem;
		border: 2px solid #cbd5e1;
		background: white;
		padding: 0.75rem;
		font-size: 0.875rem;
		line-height: 1.5;
		transition: border-color 0.2s ease;
		resize: vertical;
		min-height: 80px;
		font-family: inherit;
	}

	.ol-input::placeholder {
		color: #94a3b8;
	}

	.ol-input:focus {
		outline: none;
		border-color: #f59e0b;
	}

	.ol-actions {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		flex-wrap: wrap;
	}

	.ol-show-btn {
		border: none;
		border-radius: 0.375rem;
		background: #f59e0b;
		color: white;
		font-weight: 600;
		font-size: 0.875rem;
		padding: 0.5rem 1rem;
		cursor: pointer;
		border: 2px solid #f59e0b;
		transition: background 0.2s ease, border-color 0.2s ease;
	}

	.ol-show-btn:hover {
		background: #d97706;
		border-color: #d97706;
	}

	.ol-show-btn.is-open {
		background: #b45309;
		border-color: #b45309;
	}

	.ol-hint {
		font-size: 0.75rem;
		color: #94a3b8;
	}

	/* Answer */
	.ol-ans {
		margin-top: 1rem;
	}

	.ol-ans-label {
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: #64748b;
		margin-bottom: 0.5rem;
	}

	.ol-ans-box {
		border-radius: 0.375rem;
		padding: 0.875rem;
		background: #fef3c7;
		border: 2px solid #fcd34d;
		color: #78350f;
		line-height: 1.6;
		font-size: 0.875rem;
	}

	.ol-ans-note {
		background: #dbeafe;
		border-color: #3b82f6;
		color: #1e3a8a;
	}

	/* Utility */
	.hidden {
		display: none !important;
	}

	/* Responsive */
	@media (max-width: 640px) {
		.onluyen-ctn {
			max-width: 100%;
		}

		.ol-toc {
			padding: 0.75rem;
		}

		.ol-toc-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 0.5rem;
		}

		.ol-toc-link {
			flex-wrap: wrap;
		}

		.ol-section-toggle {
			padding: 0.875rem 1rem;
			gap: 0.5rem;
		}

		.ol-section-title {
			font-size: 1rem;
		}

		.ol-section-content {
			padding: 1rem;
		}

		.ol-note-card {
			flex-direction: column;
			padding: 0.875rem;
		}

		.ol-note-input {
			min-width: 100%;
		}

		.ol-item {
			padding: 0.875rem;
		}

		.ol-actions {
			flex-direction: column;
			align-items: stretch;
		}

		.ol-show-btn {
			width: 100%;
		}
	}

	/* Print styles */
	@media print {
		.ol-section-header {
			position: static;
		}

		.ol-section-toggle {
			cursor: default;
		}

		.ol-section-content.is-collapsed {
			max-height: none;
			opacity: 1;
		}

		.ol-input {
			border: 1px solid #ccc;
		}
	}
</style>

