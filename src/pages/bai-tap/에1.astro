---
import BaiTapLayout from '../../layouts/BaiTapLayout.astro';
import PracticeProgress from '../../components/bai-tap/PracticeProgress.astro';
import SectionRecap from '../../components/bai-tap/SectionRecap.astro';
import SectionRecognition from '../../components/bai-tap/SectionRecognition.astro';
import SectionFillBlank from '../../components/bai-tap/SectionFillBlank.astro';
import SectionSentence from '../../components/bai-tap/SectionSentence.astro';
import SectionMiniTest from '../../components/bai-tap/SectionMiniTest.astro';
import PracticeInteractions from '../../components/bai-tap/PracticeInteractions.astro';

const badges = [
  { label: '초급', bgClass: 'bg-blue-100', textClass: 'text-blue-800' },
  { label: '조사', bgClass: 'bg-green-100', textClass: 'text-green-800' },
  { label: 'Địa điểm', bgClass: 'bg-purple-100', textClass: 'text-purple-800' }
];

const sectionNav = [
  { number: 1, label: 'Recap' },
  { number: 2, label: 'Nhận diện' },
  { number: 3, label: 'Điền từ' },
  { number: 4, label: 'Tạo câu' },
  { number: 5, label: 'Mini Test' }
];

const recapDescription =
  "Trước khi làm bài, hãy ôn lại kiến thức cơ bản về '에' bằng cách trả lời 3 câu hỏi sau. Bấm nút \"Hiện đáp án\" để xem câu trả lời.";

const recapCards = [
  {
    id: 1,
    title: 'Thẻ 1',
    gradientClass: 'bg-gradient-to-br from-blue-50 to-indigo-50',
    borderClass: 'border-blue-200',
    buttonClass: 'text-blue-600 hover:text-blue-800 border-blue-300 hover:bg-blue-50',
    question: "'에' có nghĩa là gì?",
    hint: "(Trợ từ '에' được dùng để chỉ điều gì?)",
    answerContent: `
      <p class="text-xl text-gray-800 mb-2 font-semibold">Vị trí tồn tại / Nơi chốn</p>
      <p class="text-gray-700 text-sm mb-2">'에' dùng để chỉ nơi mà người/vật đang ở, đang tồn tại</p>
      <p class="text-gray-600 text-sm italic">Ví dụ: 어디에 있어요? (Đang ở đâu?), 교실에 있어요 (Ở trong lớp)</p>
    `
  },
  {
    id: 2,
    title: 'Thẻ 2',
    gradientClass: 'bg-gradient-to-br from-green-50 to-emerald-50',
    borderClass: 'border-green-200',
    buttonClass: 'text-green-600 hover:text-green-800 border-green-300 hover:bg-green-50',
    question: "Kể tên 3 động từ thường dùng với '에'",
    hint: "(Động từ nào thường đi kèm với '에'?)",
    answerContent: `
      <p class="text-xl text-gray-800 mb-2 font-semibold">있다 / 없다 / 살다</p>
      <p class="text-gray-700 text-sm mb-2">Các động từ tồn tại:</p>
      <ul class="text-gray-600 text-sm space-y-1 ml-4 list-disc">
        <li><strong>있다</strong> - có, ở</li>
        <li><strong>없다</strong> - không có</li>
        <li><strong>살다</strong> - sống</li>
      </ul>
      <p class="text-gray-600 text-sm italic mt-2">Ví dụ: 집에 있어요 (Ở nhà), 서울에 살아요 (Sống ở Seoul)</p>
    `
  },
  {
    id: 3,
    title: 'Thẻ 3',
    gradientClass: 'bg-gradient-to-br from-purple-50 to-pink-50',
    borderClass: 'border-purple-200',
    buttonClass: 'text-purple-600 hover:text-purple-800 border-purple-300 hover:bg-purple-50',
    question: "Cấu trúc cơ bản của câu dùng '에'",
    hint: "(Công thức để viết câu có '에'?)",
    answerContent: `
      <p class="text-xl text-gray-800 mb-2 font-semibold">Danh từ + 에 + 있다 / 없다 / 살다</p>
      <p class="text-gray-700 text-sm mb-2">Công thức:</p>
      <div class="bg-white rounded p-3 mb-2 border-l-4 border-purple-500">
        <p class="text-gray-800 font-mono text-sm"><strong>Nơi chốn</strong> + 에 + <strong>Động từ tồn tại</strong></p>
      </div>
      <p class="text-gray-700 text-sm mb-1">Ví dụ:</p>
      <ul class="text-gray-600 text-sm space-y-1 ml-4 list-disc">
        <li>교실에 시계가 있어요 (Trong lớp có đồng hồ)</li>
        <li>서울에 살아요 (Sống ở Seoul)</li>
        <li>냉장고에 우유가 없어요 (Trong tủ lạnh không có sữa)</li>
      </ul>
    `
  }
];

const recognitionQuestions = [
  {
    id: 's2q1',
    number: 1,
    prompt: '어떤 문장이 자연스럽습니까?',
    options: [
      { value: 'A', label: 'A. 학생들이 학교에 공부해요.' },
      { value: 'B', label: 'B. 학생들이 학교에서 공부해요.' }
    ],
    correctValue: 'B',
    correctLabel: 'B',
    explanation: "Giải thích: '공부하다' là hành động → dùng '에서'"
  },
  {
    id: 's2q2',
    number: 2,
    prompt: '어떤 문장이 맞습니까?',
    options: [
      { value: 'A', label: 'A. 냉장고에서 우유가 있어요.' },
      { value: 'B', label: 'B. 냉장고에 우유가 있어요.' }
    ],
    correctValue: 'B',
    correctLabel: 'B',
    explanation: "Giải thích: '있어요' là động từ tồn tại → dùng '에'"
  },
  {
    id: 's2q3',
    number: 3,
    prompt: '틀린 문장을 고르세요.',
    options: [
      { value: '1', label: '1. 냉장고에 우유가 있어요.' },
      { value: '2', label: '2. 학생들이 운동장에 축구해요.' },
      { value: '3', label: '3. 저는 신촌에 살아요.' }
    ],
    correctValue: '2',
    correctLabel: '2',
    explanation: "Giải thích: '축구하다' là hành động → phải dùng '에서'"
  }
];

const section2Answers = Object.fromEntries(recognitionQuestions.map((question) => [question.id, question.correctValue]));

const fillBlankQuestions = [
  {
    id: 's3q1',
    number: 1,
    sentence: '학생들이 도서관( ) 공부해요.',
    answer: '에서',
    explanation: "'공부하다' là hành động → dùng '에서'"
  },
  {
    id: 's3q2',
    number: 2,
    sentence: '고양이가 침대( ) 있어요.',
    answer: '에',
    explanation: "'있어요' là động từ tồn tại → dùng '에'"
  },
  {
    id: 's3q3',
    number: 3,
    sentence: '저는 한국( ) 살아요.',
    answer: '에',
    explanation: "'살다' với nghĩa tồn tại/cư trú → dùng '에'"
  },
  {
    id: 's3q4',
    number: 4,
    sentence: '사람들이 공원( ) 산책해요.',
    answer: '에서',
    explanation: "'산책하다' là hành động → dùng '에서'"
  },
  {
    id: 's3q5',
    number: 5,
    sentence: '냉장고( ) 물이 있어요.',
    answer: '에',
    explanation: "'있어요' là động từ tồn tại → dùng '에'"
  }
];

const section3Answers = Object.fromEntries(fillBlankQuestions.map((question) => [question.id, question.answer]));

const wordBuilder = {
  targetSentence: '교실에 시계가 있어요',
  wordPool: ['교실에', '있어요', '시계가']
};

const guidedWriting = {
  id: 's4q2',
  title: 'Bài 2: Viết câu theo gợi ý',
  prompt: '(학생들 / 운동장 / 있다)',
  hint: 'Nhớ chia động từ: 있다 → 있어요 / 있습니다.',
  answers: ['학생들이 운동장에 있어요', '학생들이 운동장에 있습니다']
};

const freeWriting = {
  id: 's4q3',
  title: 'Bài 3: Tạo câu tự do',
  prompt: "Gợi ý: 교실 - Hãy tạo 1 câu có '에 + 있다/없다/살다'"
};

const miniChoiceQuestions = [
  {
    id: 's5q1',
    number: 1,
    prompt: 'Chọn câu đúng:',
    options: [
      { value: 'A', label: 'A. 냉장고에서 우유가 있어요.' },
      { value: 'B', label: 'B. 냉장고에 우유가 있어요.' }
    ],
    correctValue: 'B'
  },
  {
    id: 's5q2',
    number: 2,
    prompt: 'Tìm câu sai:',
    options: [
      { value: '1', label: '1. 학생들이 운동장에 축구해요.' },
      { value: '2', label: '2. 고양이가 침대에 있어요.' },
      { value: '3', label: '3. 저는 서울에 살아요.' }
    ],
    correctValue: '1'
  }
];

const miniFillQuestions = [
  {
    id: 's5q3',
    number: 3,
    sentence: '저는 한국( ) 살아요.',
    answer: '에'
  },
  {
    id: 's5q4',
    number: 4,
    sentence: '사람들이 공원( ) 산책해요.',
    answer: '에서'
  }
];

const miniWritingQuestions = [
  { id: 's5q5', number: 5, prompt: 'Bạn đang ở đâu? (Viết câu trả lời)' },
  { id: 's5q6', number: 6, prompt: 'Trong phòng bạn có gì? (Viết câu)' }
];

const section5ChoiceAnswers = Object.fromEntries(miniChoiceQuestions.map((question) => [question.id, question.correctValue]));
const section5FillAnswers = Object.fromEntries(miniFillQuestions.map((question) => [question.id, question.answer]));
const section5Answers = { ...section5ChoiceAnswers, ...section5FillAnswers };
---

<BaiTapLayout
  title="Bài tập 에1 - The Free Korean"
  pageTitle="조사 '에 (1)' — Ôn tập online"
  subtitle="Từ nhận diện → sử dụng thành thạo"
  badges={badges}
>
  <PracticeProgress slot="progress" sections={sectionNav} />

  <SectionRecap description={recapDescription} cards={recapCards} />

  <SectionRecognition questions={recognitionQuestions} />

  <SectionFillBlank questions={fillBlankQuestions} />

  <SectionSentence wordBuilder={wordBuilder} guidedWriting={guidedWriting} freeWriting={freeWriting} />

  <SectionMiniTest choiceQuestions={miniChoiceQuestions} fillQuestions={miniFillQuestions} writingQuestions={miniWritingQuestions} />

  <PracticeInteractions
    sectionCount={5}
    section2Answers={section2Answers}
    section3Answers={section3Answers}
    section5Answers={section5Answers}
  />
</BaiTapLayout>

