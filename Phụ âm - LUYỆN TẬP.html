<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Tập Phụ Âm Tiếng Hàn (Cấu Trúc Mới - Cập Nhật Bài 1 Lần 3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Visualization & Content Choices:
    - Navigation: List of buttons for "Bài 1" through "Bài 5".
    - Exercise 1 (Comprehensive Single Syllable - Visual Groups):
        - Goal: Practice single syllables with direct consonant/vowel selection from visually grouped sections.
        - Viz/Presentation: Visually distinct sections for Plain Consonants, Aspirated Consonants, Tense Consonants, Basic Vowels, and Double Vowels, each containing their respective character buttons. Display for main/comparison syllables (comparison always shown if applicable). "Random Single Syllable" button (from all characters).
    - Exercises 2-4 (Sequence Reading): (Same as before)
    - Exercise 5 (Vocabulary Practice): (Same as before)
    - All text in Vietnamese.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4;
            color: #44403c;
        }
        .syllable-display-container, .sequence-display-container, .vocab-display-container {
            border: 2px solid #bfdbfe;
            background-color: #ffffff;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.5rem;
            border-radius: 0.5rem;
        }
        .syllable-char-display {
            font-size: 3rem; 
            line-height: 1.2;
            min-height: 60px;
        }
        .syllable-sequence-display, .vocab-word-display, .vocab-meaning-display {
            font-size: 2rem; 
            line-height: 1.5;
            min-height: 60px; 
            padding: 1rem;
            text-align: center;
        }
        .vocab-meaning-display {
            color: #3b82f6; 
        }
         .syllable-label, .group-label {
            font-size: 0.875rem; 
            color: #57534e;
            margin-bottom: 0.25rem;
            display: block;
        }
        .group-label {
            font-weight: 600; /* semibold */
            color: #1d4ed8; /* blue-700 */
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #dbeafe; /* blue-200 */
        }
        .btn-char, .nav-btn {
            transition: all 0.2s ease-in-out;
            border: 1px solid #93c5fd;
        }
        .btn-char:hover, .nav-btn:hover {
            background-color: #60a5fa;
            color: #eff6ff;
        }
        .btn-char.selected, .nav-btn.active {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
            border-color: #2563eb;
        }
        .btn-action {
            background-color: #60a5fa;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: all 0.2s ease-in-out;
        }
        .btn-action:hover {
            background-color: #3b82f6;
        }
        .exercise-section {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            display: none; 
        }
        .exercise-section.active {
            display: block; 
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #navigation-menu button {
            display: block;
            width: 100%;
            text-align: left;
            margin-bottom: 0.5rem;
            padding: 0.75rem 1rem;
        }
        .character-grid {
            display: grid;
            gap: 0.5rem; /* Tailwind gap-2 */
        }
        /* Adjust grid columns for different character groups */
        #consonants-plain-grid { grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); } /* More flexible */
        #consonants-aspirated-grid { grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); }
        #consonants-tense-grid { grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); }
        #vowels-basic-grid { grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); }
        #vowels-double-grid { grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); }


    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8 max-w-6xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-blue-700" style="font-family: 'Noto Sans KR', sans-serif;">Luyện Tập Phụ Âm Tiếng Hàn (Cấu Trúc Mới)</h1>
        </header>

        <div class="flex flex-col md:flex-row gap-8">
            <aside class="w-full md:w-1/4">
                <h2 class="text-xl font-semibold text-blue-600 mb-4">Mục Lục Bài Tập</h2>
                <nav id="navigation-menu">
                    </nav>
            </aside>

            <main class="w-full md:w-3/4">
                <div id="exercise-content-area">
                    </div>
            </main>
        </div>

        <footer class="text-center mt-12 py-6 border-t border-stone-300">
            <p class="text-sm text-stone-500">Ứng dụng luyện tập tổng hợp phụ âm tiếng Hàn. Phát triển bởi AI.</p>
        </footer>
    </div>

    <script>
        const exercises = [
            { id: 'ex_single_syllable', title: 'Bài 1: Luyện Phát Âm Đơn Âm Tiết (Tổng Hợp)', isSingleSyllablePractice: true },
            { id: 'ex_seq_easy', title: 'Bài 2: Đọc Chuỗi (Dễ)', isSequenceReading: true, sequenceParams: { countRange: [2, 3], consonantTypes: ['plain'], vowelGroupKey: 'basic_y' } },
            { id: 'ex_seq_medium', title: 'Bài 3: Đọc Chuỗi (Trung Bình)', isSequenceReading: true, sequenceParams: { countRange: [3, 4], consonantTypes: ['plain', 'aspirated'], vowelGroupKey: 'all' } },
            { id: 'ex_seq_hard', title: 'Bài 4: Đọc Chuỗi (Khó)', isSequenceReading: true, sequenceParams: { countRange: [4, 5], consonantTypes: ['plain', 'aspirated', 'tense'], vowelGroupKey: 'all' } },
            { id: 'ex_vocab', title: 'Bài 5: Luyện Từ Vựng', isVocabularyPractice: true }
        ];

        const allConsonantsWithTypes = [ 
            { char: 'ㄱ', type: 'plain' }, { char: 'ㄴ', type: 'plain' }, { char: 'ㄷ', type: 'plain' }, { char: 'ㄹ', type: 'plain' },
            { char: 'ㅁ', type: 'plain' }, { char: 'ㅂ', type: 'plain' }, { char: 'ㅅ', type: 'plain' }, { char: 'ㅇ', type: 'plain' },
            { char: 'ㅈ', type: 'plain' }, { char: 'ㅎ', type: 'plain' },
            { char: 'ㅋ', type: 'aspirated' }, { char: 'ㅌ', type: 'aspirated' }, { char: 'ㅍ', type: 'aspirated' }, { char: 'ㅊ', type: 'aspirated' },
            { char: 'ㄲ', type: 'tense' }, { char: 'ㄸ', type: 'tense' }, { char: 'ㅃ', type: 'tense' }, { char: 'ㅆ', type: 'tense' }, { char: 'ㅉ', type: 'tense' }
        ];
        
        const consonantGroupsForDisplay = { 
            plain: ['ㄱ', 'ㄴ', 'ㄷ', 'ㄹ', 'ㅁ', 'ㅂ', 'ㅅ', 'ㅇ', 'ㅈ', 'ㅎ'],
            aspirated: ['ㅋ', 'ㅌ', 'ㅍ', 'ㅊ'],
            tense: ['ㄲ', 'ㄸ', 'ㅃ', 'ㅆ', 'ㅉ']
        };

        const vowelGroupsForDisplay = { 
            basic: ['ㅏ', 'ㅑ', 'ㅓ', 'ㅕ', 'ㅗ', 'ㅛ', 'ㅜ', 'ㅠ', 'ㅡ', 'ㅣ'], 
            double: ['ㅐ', 'ㅒ', 'ㅔ', 'ㅖ', 'ㅘ', 'ㅙ', 'ㅚ', 'ㅝ', 'ㅞ', 'ㅟ', 'ㅢ'] 
        };
         const allVowelsForRandom = [...vowelGroupsForDisplay.basic, ...vowelGroupsForDisplay.double];
        
        const vowelGroupsForSequence = { // Used by sequence generation logic
            all: allVowelsForRandom,
            basic_y: vowelGroupsForDisplay.basic 
        };
        
        const aspiratedToPlainMap = {'ㅋ': 'ㄱ', 'ㅌ': 'ㄷ', 'ㅍ': 'ㅂ', 'ㅊ': 'ㅈ'};
        const tenseToPlainMap = {'ㄲ': 'ㄱ', 'ㄸ': 'ㄷ', 'ㅃ': 'ㅂ', 'ㅆ': 'ㅅ', 'ㅉ': 'ㅈ'};

        const syllableMaps = { 
            plain: {
                'ㄱ': {'ㅏ':'가', 'ㅐ':'개', 'ㅑ':'갸', 'ㅒ':'걔', 'ㅓ':'거', 'ㅔ':'게', 'ㅕ':'겨', 'ㅖ':'계', 'ㅗ':'고', 'ㅘ':'과', 'ㅙ':'괘', 'ㅚ':'괴', 'ㅛ':'교', 'ㅜ':'구', 'ㅝ':'궈', 'ㅞ':'궤', 'ㅟ':'귀', 'ㅠ':'규', 'ㅡ':'그', 'ㅢ':'긔', 'ㅣ':'기'},
                'ㄴ': {'ㅏ':'나', 'ㅐ':'내', 'ㅑ':'냐', 'ㅒ':'냬', 'ㅓ':'너', 'ㅔ':'네', 'ㅕ':'녀', 'ㅖ':'녜', 'ㅗ':'노', 'ㅘ':'놔', 'ㅙ':'놰', 'ㅚ':'뇌', 'ㅛ':'뇨', 'ㅜ':'누', 'ㅝ':'눠', 'ㅞ':'눼', 'ㅟ':'뉘', 'ㅠ':'뉴', 'ㅡ':'느', 'ㅢ':'늬', 'ㅣ':'니'},
                'ㄷ': {'ㅏ':'다', 'ㅐ':'대', 'ㅑ':'댜', 'ㅒ':'댸', 'ㅓ':'더', 'ㅔ':'데', 'ㅕ':'뎌', 'ㅖ':'뎨', 'ㅗ':'도', 'ㅘ':'돠', 'ㅙ':'돼', 'ㅚ':'되', 'ㅛ':'됴', 'ㅜ':'두', 'ㅝ':'둬', 'ㅞ':'뒈', 'ㅟ':'뒤', 'ㅠ':'듀', 'ㅡ':'드', 'ㅢ':'듸', 'ㅣ':'디'},
                'ㄹ': {'ㅏ':'라', 'ㅐ':'래', 'ㅑ':'랴', 'ㅒ':'럐', 'ㅓ':'러', 'ㅔ':'레', 'ㅕ':'려', 'ㅖ':'례', 'ㅗ':'로', 'ㅘ':'롸', 'ㅙ':'뢔', 'ㅚ':'뢰', 'ㅛ':'료', 'ㅜ':'루', 'ㅝ':'뤄', 'ㅞ':'뤠', 'ㅟ':'뤼', 'ㅠ':'류', 'ㅡ':'르', 'ㅢ':'릐', 'ㅣ':'리'},
                'ㅁ': {'ㅏ':'마', 'ㅐ':'매', 'ㅑ':'먀', 'ㅒ':'먜', 'ㅓ':'머', 'ㅔ':'메', 'ㅕ':'며', 'ㅖ':'몌', 'ㅗ':'모', 'ㅘ':'뫄', 'ㅙ':'뫠', 'ㅚ':'뫼', 'ㅛ':'묘', 'ㅜ':'무', 'ㅝ':'뭐', 'ㅞ':'뭬', 'ㅟ':'뮈', 'ㅠ':'뮤', 'ㅡ':'므', 'ㅢ':'믜', 'ㅣ':'미'},
                'ㅂ': {'ㅏ':'바', 'ㅐ':'배', 'ㅑ':'뱌', 'ㅒ':'뱨', 'ㅓ':'버', 'ㅔ':'베', 'ㅕ':'벼', 'ㅖ':'볘', 'ㅗ':'보', 'ㅘ':'봐', 'ㅙ':'봬', 'ㅚ':'뵈', 'ㅛ':'뵤', 'ㅜ':'부', 'ㅝ':'붜', 'ㅞ':'붸', 'ㅟ':'뷔', 'ㅠ':'뷰', 'ㅡ':'브', 'ㅢ':'븨', 'ㅣ':'비'},
                'ㅅ': {'ㅏ':'사', 'ㅐ':'새', 'ㅑ':'샤', 'ㅒ':'섀', 'ㅓ':'서', 'ㅔ':'세', 'ㅕ':'셔', 'ㅖ':'셰', 'ㅗ':'소', 'ㅘ':'솨', 'ㅙ':'쇄', 'ㅚ':'쇠', 'ㅛ':'쇼', 'ㅜ':'수', 'ㅝ':'숴', 'ㅞ':'쉐', 'ㅟ':'쉬', 'ㅠ':'슈', 'ㅡ':'스', 'ㅢ':'싀', 'ㅣ':'시'},
                'ㅇ': {'ㅏ':'아', 'ㅐ':'애', 'ㅑ':'야', 'ㅒ':'얘', 'ㅓ':'어', 'ㅔ':'에', 'ㅕ':'여', 'ㅖ':'예', 'ㅗ':'오', 'ㅘ':'와', 'ㅙ':'왜', 'ㅚ':'외', 'ㅛ':'요', 'ㅜ':'우', 'ㅝ':'워', 'ㅞ':'웨', 'ㅟ':'위', 'ㅠ':'유', 'ㅡ':'으', 'ㅢ':'의', 'ㅣ':'이'},
                'ㅈ': {'ㅏ':'자', 'ㅐ':'재', 'ㅑ':'쟈', 'ㅒ':'쟤', 'ㅓ':'저', 'ㅔ':'제', 'ㅕ':'져', 'ㅖ':'졔', 'ㅗ':'조', 'ㅘ':'좌', 'ㅙ':'좨', 'ㅚ':'죄', 'ㅛ':'죠', 'ㅜ':'주', 'ㅝ':'줘', 'ㅞ':'줴', 'ㅟ':'쥐', 'ㅠ':'쥬', 'ㅡ':'즈', 'ㅢ':'즤', 'ㅣ':'지'},
                'ㅎ': {'ㅏ':'하', 'ㅐ':'해', 'ㅑ':'햐', 'ㅒ':'햬', 'ㅓ':'허', 'ㅔ':'헤', 'ㅕ':'혀', 'ㅖ':'혜', 'ㅗ':'호', 'ㅘ':'화', 'ㅙ':'홰', 'ㅚ':'회', 'ㅛ':'효', 'ㅜ':'후', 'ㅝ':'훠', 'ㅞ':'훼', 'ㅟ':'휘', 'ㅠ':'휴', 'ㅡ':'흐', 'ㅢ':'희', 'ㅣ':'히'}
            },
            aspirated: {
                'ㅋ': {'ㅏ':'카', 'ㅐ':'캐', 'ㅑ':'캬', 'ㅒ':'컈', 'ㅓ':'커', 'ㅔ':'케', 'ㅕ':'켜', 'ㅖ':'켸', 'ㅗ':'코', 'ㅘ':'콰', 'ㅙ':'쾌', 'ㅚ':'쾨', 'ㅛ':'쿄', 'ㅜ':'쿠', 'ㅝ':'쿼', 'ㅞ':'퀘', 'ㅟ':'퀴', 'ㅠ':'큐', 'ㅡ':'크', 'ㅢ':'킈', 'ㅣ':'키'},
                'ㅌ': {'ㅏ':'타', 'ㅐ':'태', 'ㅑ':'탸', 'ㅒ':'턔', 'ㅓ':'터', 'ㅔ':'테', 'ㅕ':'텨', 'ㅖ':'톄', 'ㅗ':'토', 'ㅘ':'톼', 'ㅙ':'퇘', 'ㅚ':'퇴', 'ㅛ':'툐', 'ㅜ':'투', 'ㅝ':'퉈', 'ㅞ':'퉤', 'ㅟ':'튀', 'ㅠ':'튜', 'ㅡ':'트', 'ㅢ':'틔', 'ㅣ':'티'},
                'ㅍ': {'ㅏ':'파', 'ㅐ':'패', 'ㅑ':'퍄', 'ㅒ':'퍠', 'ㅓ':'퍼', 'ㅔ':'페', 'ㅕ':'펴', 'ㅖ':'폐', 'ㅗ':'포', 'ㅘ':'퐈', 'ㅙ':'퐤', 'ㅚ':'푀', 'ㅛ':'표', 'ㅜ':'푸', 'ㅝ':'풔', 'ㅞ':'풰', 'ㅟ':'퓌', 'ㅠ':'퓨', 'ㅡ':'프', 'ㅢ':'픠', 'ㅣ':'피'},
                'ㅊ': {'ㅏ':'차', 'ㅐ':'채', 'ㅑ':'챠', 'ㅒ':'챼', 'ㅓ':'처', 'ㅔ':'체', 'ㅕ':'쳐', 'ㅖ':'쳬', 'ㅗ':'초', 'ㅘ':'촤', 'ㅙ':'쵀', 'ㅚ':'최', 'ㅛ':'쵸', 'ㅜ':'추', 'ㅝ':'춰', 'ㅞ':'췌', 'ㅟ':'취', 'ㅠ':'츄', 'ㅡ':'츠', 'ㅢ':'츼', 'ㅣ':'치'}
            },
            tense: {
                'ㄲ': {'ㅏ':'까', 'ㅐ':'깨', 'ㅑ':'꺄', 'ㅒ':'꺠', 'ㅓ':'꺼', 'ㅔ':'께', 'ㅕ':'껴', 'ㅖ':'꼐', 'ㅗ':'꼬', 'ㅘ':'꽈', 'ㅙ':'꽤', 'ㅚ':'꾀', 'ㅛ':'꾜', 'ㅜ':'꾸', 'ㅝ':'꿔', 'ㅞ':'꿰', 'ㅟ':'뀌', 'ㅠ':'뀨', 'ㅡ':'끄', 'ㅢ':'끠', 'ㅣ':'끼'},
                'ㄸ': {'ㅏ':'따', 'ㅐ':'때', 'ㅑ':'땨', 'ㅒ':'떄', 'ㅓ':'떠', 'ㅔ':'떼', 'ㅕ':'뗘', 'ㅖ':'뗴', 'ㅗ':'또', 'ㅘ':'똬', 'ㅙ':'뙈', 'ㅚ':'뙤', 'ㅛ':'뚀', 'ㅜ':'뚜', 'ㅝ':'뚸', 'ㅞ':'뛔', 'ㅟ':'뛰', 'ㅠ':'뜌', 'ㅡ':'뜨', 'ㅢ':'띄', 'ㅣ':'띠'},
                'ㅃ': {'ㅏ':'빠', 'ㅐ':'빼', 'ㅑ':'뺘', 'ㅒ':'뺴', 'ㅓ':'뻐', 'ㅔ':'뻬', 'ㅕ':'뼈', 'ㅖ':'뼤', 'ㅗ':'뽀', 'ㅘ':'뽜', 'ㅙ':'뽸', 'ㅚ':'뾔', 'ㅛ':'뾰', 'ㅜ':'뿌', 'ㅝ':'뿨', 'ㅞ':'쀄', 'ㅟ':'쀠', 'ㅠ':'쀼', 'ㅡ':'쁘', 'ㅢ':'쁴', 'ㅣ':'삐'},
                'ㅆ': {'ㅏ':'싸', 'ㅐ':'쌔', 'ㅑ':'쌰', 'ㅒ':'썌', 'ㅓ':'써', 'ㅔ':'쎄', 'ㅕ':'쎠', 'ㅖ':'쎼', 'ㅗ':'쏘', 'ㅘ':'쏴', 'ㅙ':'쐐', 'ㅚ':'쇠', 'ㅛ':'쑈', 'ㅜ':'쑤', 'ㅝ':'쒀', 'ㅞ':'쒜', 'ㅟ':'쒸', 'ㅠ':'쓔', 'ㅡ':'쓰', 'ㅢ':'씌', 'ㅣ':'씨'},
                'ㅉ': {'ㅏ':'짜', 'ㅐ':'째', 'ㅑ':'쨔', 'ㅒ':'쨰', 'ㅓ':'쩌', 'ㅔ':'쩨', 'ㅕ':'쪄', 'ㅖ':'쪠', 'ㅗ':'쪼', 'ㅘ':'쫘', 'ㅙ':'쫴', 'ㅚ':'쬐', 'ㅛ':'쬬', 'ㅜ':'쭈', 'ㅝ':'쭤', 'ㅞ':'쮀', 'ㅟ':'쮜', 'ㅠ':'쮸', 'ㅡ':'쯔', 'ㅢ':'쯰', 'ㅣ':'찌'}
            }
        };
        const vocabulary = [
            { word: '가구', meaning: 'Đồ nội thất' }, { word: '나라', meaning: 'Đất nước' },
            { word: '다리', meaning: 'Chân, Cây cầu' }, { word: '라디오', meaning: 'Đài radio' },
            { word: '마음', meaning: 'Tấm lòng' }, { word: '바다', meaning: 'Biển' },
            { word: '사자', meaning: 'Sư tử' }, { word: '아기', meaning: 'Em bé' },
            { word: '자다', meaning: 'Ngủ' }, { word: '차', meaning: 'Xe, Trà' },
            { word: '코', meaning: 'Mũi' }, { word: '타다', meaning: 'Đi (xe), Cháy' },
            { word: '파도', meaning: 'Sóng biển' }, { word: '하다', meaning: 'Làm' },
            { word: '까치', meaning: 'Chim ác là' }, { word: '토끼', meaning: 'Con thỏ' },
            { word: '빵', meaning: 'Bánh mì' }, { word: '쓰다', meaning: 'Viết, Đắng, Đội (nón)' },
            { word: '짜다', meaning: 'Mặn' }, { word: '크다', meaning: 'To, Lớn' },
            { word: '나무', meaning: 'Cây' }, { word: '소리', meaning: 'Âm thanh, Tiếng động' },
            { word: '머리', meaning: 'Đầu' }, { word: '오이', meaning: 'Dưa chuột' }
        ];

        let activeExerciseId = 'ex_single_syllable';
        let selectedConsonant = null; 
        let selectedVowel = null;
        let selectedConsonantActualType = 'plain'; 
        let currentVocabIndex = -1;

        const navigationMenu = document.getElementById('navigation-menu');
        const exerciseContentArea = document.getElementById('exercise-content-area');

        // --- Element variables (will be reassigned in render functions) ---
        let mainSyllableCharDisplay, plainComparisonSyllableCharDisplay, syllablePlaceholder, 
            consonantsPlainGrid, consonantsAspiratedGrid, consonantsTenseGrid,
            vowelsBasicGrid, vowelsDoubleGrid,
            randomSingleSyllableButtonInteractive, interactiveSyllableGrid;

        let syllableSequenceDisplay, generateSequenceButton;
        
        let vocabWordDisplay, vocabMeaningDisplay, nextVocabButton, showMeaningButton;
        
        function renderExerciseUI(exercise) {
            exerciseContentArea.innerHTML = ''; 
            selectedConsonant = null; 
            selectedVowel = null;

            if (exercise.isSingleSyllablePractice) {
                renderSingleSyllablePracticeUI(exercise);
            } else if (exercise.isSequenceReading) {
                renderSequenceReadingUI(exercise);
            } else if (exercise.isVocabularyPractice) {
                renderVocabularyPracticeUI(exercise);
            }
        }

        function renderSingleSyllablePracticeUI(exercise) {
            exerciseContentArea.innerHTML = `
                <section id="single-syllable-practice-section" class="exercise-section active">
                    <h2 class="text-2xl font-semibold text-blue-600 mb-3" style="font-family: 'Noto Sans KR', sans-serif;">${exercise.title}</h2>
                    <p id="interactive-instructions" class="text-stone-600 mb-6">Chọn một phụ âm và một nguyên âm. Âm chính và âm thường tương ứng (nếu có) sẽ được hiển thị để so sánh.</p>
                    
                    <div class="flex flex-col lg:flex-row gap-8 items-start">
                        <div class="w-full lg:w-1/2">
                            <div>
                                <h3 class="group-label">Phụ Âm Thường</h3>
                                <div id="consonants-plain-grid" class="character-grid mb-4"></div>
                                <h3 class="group-label">Phụ Âm Bật Hơi</h3>
                                <div id="consonants-aspirated-grid" class="character-grid mb-4"></div>
                                <h3 class="group-label">Phụ Âm Căng</h3>
                                <div id="consonants-tense-grid" class="character-grid"></div>
                            </div>
                        </div>
                        <div class="w-full lg:w-1/2">
                            <div>
                                <h3 class="group-label">Nguyên Âm Thường (10)</h3>
                                <div id="vowels-basic-grid" class="character-grid mb-4"></div>
                                <h3 class="group-label">Nguyên Âm Đôi (11)</h3>
                                <div id="vowels-double-grid" class="character-grid"></div>
                            </div>
                            <div class="mt-8">
                                <h3 class="text-lg font-semibold mb-2 text-center text-blue-700">Âm Tiết Kết Hợp</h3>
                                <div id="syllable-display-container" class="syllable-display-container">
                                    <div id="interactive-syllable-grid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center text-center">
                                        <div class="main-syllable-column">
                                            <span class="syllable-label">Âm Chính</span>
                                            <div id="main-syllable-char" class="syllable-char-display text-blue-700 font-bold" style="font-family: 'Noto Sans KR', sans-serif;">--</div>
                                        </div>
                                        <div class="plain-comparison-column">
                                            <span class="syllable-label">Âm Thường T.Ứng (Nếu có)</span>
                                            <div id="plain-comparison-syllable-char" class="syllable-char-display text-blue-600" style="font-family: 'Noto Sans KR', sans-serif;">--</div>
                                        </div>
                                    </div>
                                    <p id="syllable-placeholder" class="text-center text-stone-500 mt-2">Chọn phụ âm & nguyên âm</p>
                                </div>
                                <div class="text-center mt-6">
                                    <button id="random-single-syllable-button-interactive" class="btn-action py-2 px-4">Âm Tiết Ngẫu Nhiên (Từ Tất Cả)</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `;
            assignInteractiveSingleElements(); 
            randomSingleSyllableButtonInteractive.addEventListener('click', generateRandomSingleSyllableInteractive);

            populateAllConsonantsForSingleSyllablePractice();
            populateAllVowelsForSingleSyllablePractice(); 
            updateSyllableDisplay(); 
        }
        
        function renderSequenceReadingUI(exercise) {
             exerciseContentArea.innerHTML = `
                <section id="sequence-reading-section" class="exercise-section active">
                    <h2 class="text-2xl font-semibold text-blue-600 mb-3" style="font-family: 'Noto Sans KR', sans-serif;">${exercise.title}</h2>
                    <p class="text-stone-600 mb-6">Nhấn nút "Tạo Chuỗi Mới" để luyện đọc một chuỗi các âm tiết.</p>
                    <div class="text-center mb-6">
                        <button id="generate-sequence-button" class="btn-action py-3 px-6 rounded-lg font-semibold text-lg shadow-md">
                            Tạo Chuỗi Mới
                        </button>
                    </div>
                    <div id="syllable-sequence-display-container" class="sequence-display-container">
                        <div id="syllable-sequence-display" class="syllable-sequence-display text-blue-700 font-bold" style="font-family: 'Noto Sans KR', sans-serif;">Hãy nhấn nút để bắt đầu!</div>
                    </div>
                </section>
            `;
            assignSequenceReadingElements();
            generateSequenceButton.addEventListener('click', () => generateSyllableSequence(exercise.sequenceParams));
            generateSyllableSequence(exercise.sequenceParams); 
        }

        function renderVocabularyPracticeUI(exercise) {
            exerciseContentArea.innerHTML = `
                <section id="vocabulary-practice-section" class="exercise-section active">
                    <h2 class="text-2xl font-semibold text-blue-600 mb-3" style="font-family: 'Noto Sans KR', sans-serif;">${exercise.title}</h2>
                    <p class="text-stone-600 mb-6">Luyện đọc từ và học nghĩa của chúng.</p>
                    <div class="vocab-display-container text-center">
                        <div id="vocab-word-display" class="vocab-word-display text-blue-700 font-bold mb-4" style="font-family: 'Noto Sans KR', sans-serif;">Nhấn "Từ Mới"</div>
                        <div id="vocab-meaning-display" class="vocab-meaning-display mb-6 hidden" style="font-family: 'Inter', sans-serif;">--</div>
                        <div class="flex justify-center gap-4">
                            <button id="next-vocab-button" class="btn-action py-2 px-4">Từ Mới</button>
                            <button id="show-meaning-button" class="btn-action py-2 px-4 bg-sky-500 hover:bg-sky-600">Xem Nghĩa</button>
                        </div>
                    </div>
                </section>
            `;
            assignVocabularyElements();
            nextVocabButton.addEventListener('click', displayNextVocabularyWord);
            showMeaningButton.addEventListener('click', toggleVocabMeaning);
            displayNextVocabularyWord(); 
        }

        function assignInteractiveSingleElements() { 
            mainSyllableCharDisplay = document.getElementById('main-syllable-char');
            plainComparisonSyllableCharDisplay = document.getElementById('plain-comparison-syllable-char');
            syllablePlaceholder = document.getElementById('syllable-placeholder');
            interactiveSyllableGrid = document.getElementById('interactive-syllable-grid'); 
            
            consonantsPlainGrid = document.getElementById('consonants-plain-grid');
            consonantsAspiratedGrid = document.getElementById('consonants-aspirated-grid');
            consonantsTenseGrid = document.getElementById('consonants-tense-grid');
            vowelsBasicGrid = document.getElementById('vowels-basic-grid');
            vowelsDoubleGrid = document.getElementById('vowels-double-grid');
            
            randomSingleSyllableButtonInteractive = document.getElementById('random-single-syllable-button-interactive');
        }
        
        function assignSequenceReadingElements() {
            syllableSequenceDisplay = document.getElementById('syllable-sequence-display');
            generateSequenceButton = document.getElementById('generate-sequence-button');
        }

        function assignVocabularyElements() {
            vocabWordDisplay = document.getElementById('vocab-word-display');
            vocabMeaningDisplay = document.getElementById('vocab-meaning-display');
            nextVocabButton = document.getElementById('next-vocab-button');
            showMeaningButton = document.getElementById('show-meaning-button');
        }

        function createConsonantButton(consonantObj, gridElement) { 
            const button = document.createElement('button');
            button.textContent = consonantObj.char;
            button.style.fontFamily = "'Noto Sans KR', sans-serif";
            button.classList.add('btn-char', 'p-3', 'rounded-md', 'text-lg', 'font-semibold', 'bg-white', 'text-blue-700', 'shadow-sm', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-400');
            button.dataset.char = consonantObj.char;
            button.dataset.consonantType = consonantObj.type; 
            button.dataset.type = 'consonant'; 
            button.addEventListener('click', handleCharSelection);
            if(gridElement) gridElement.appendChild(button);
        }
        
        function createVowelButton(char, gridElement) {
            const button = document.createElement('button');
            button.textContent = char;
            button.style.fontFamily = "'Noto Sans KR', sans-serif";
            button.classList.add('btn-char', 'p-2', 'sm:p-3', 'rounded-md', 'text-base', 'sm:text-lg', 'font-semibold', 'bg-white', 'text-blue-700', 'shadow-sm', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-400');
            button.dataset.char = char;
            button.dataset.type = 'vowel';
            button.addEventListener('click', handleCharSelection);
            if(gridElement) gridElement.appendChild(button);
        }

        function populateAllConsonantsForSingleSyllablePractice() {
            if (!consonantsPlainGrid || !consonantsAspiratedGrid || !consonantsTenseGrid) return;
            consonantsPlainGrid.innerHTML = '';
            consonantsAspiratedGrid.innerHTML = '';
            consonantsTenseGrid.innerHTML = '';

            if (selectedConsonant) selectedConsonant.classList.remove('selected');
            selectedConsonant = null; 
            
            allConsonantsWithTypes.forEach(cObj => {
                if (cObj.type === 'plain') createConsonantButton(cObj, consonantsPlainGrid);
                else if (cObj.type === 'aspirated') createConsonantButton(cObj, consonantsAspiratedGrid);
                else if (cObj.type === 'tense') createConsonantButton(cObj, consonantsTenseGrid);
            });
            updateSyllableDisplay();
        }
        
        function populateAllVowelsForSingleSyllablePractice() {
            if (!vowelsBasicGrid || !vowelsDoubleGrid) return;
            vowelsBasicGrid.innerHTML = '';
            vowelsDoubleGrid.innerHTML = '';

            if (selectedVowel) selectedVowel.classList.remove('selected');
            selectedVowel = null; 
            
            vowelGroupsForDisplay.basic.forEach(v => createVowelButton(v, vowelsBasicGrid));
            vowelGroupsForDisplay.double.forEach(v => createVowelButton(v, vowelsDoubleGrid));
            updateSyllableDisplay();
        }
        
        function handleCharSelection(event) {
            const button = event.target;
            const char = button.dataset.char;
            const type = button.dataset.type; // 'consonant' or 'vowel'

            if (type === 'consonant') {
                // Deselect previously selected consonant from ANY grid
                const allConsonantButtons = document.querySelectorAll('#single-syllable-practice-section .btn-char[data-type="consonant"]');
                allConsonantButtons.forEach(btn => btn.classList.remove('selected'));

                if (selectedConsonant === button) {
                    selectedConsonant = null;
                    selectedConsonantActualType = 'plain'; 
                } else { 
                    selectedConsonant = button; 
                    selectedConsonant.classList.add('selected');
                    selectedConsonantActualType = button.dataset.consonantType; 
                }
            } else if (type === 'vowel') {
                const allVowelButtons = document.querySelectorAll('#single-syllable-practice-section .btn-char[data-type="vowel"]');
                allVowelButtons.forEach(btn => btn.classList.remove('selected'));

                if (selectedVowel === button) selectedVowel = null;
                else { selectedVowel = button; selectedVowel.classList.add('selected'); }
            }
            updateSyllableDisplay();
        }

        function updateSyllableDisplay() {
            if (!mainSyllableCharDisplay || !plainComparisonSyllableCharDisplay || !syllablePlaceholder || !interactiveSyllableGrid) return; 

            mainSyllableCharDisplay.classList.remove('fade-in'); 
            plainComparisonSyllableCharDisplay.classList.remove('fade-in');
            void mainSyllableCharDisplay.offsetWidth; 

            let hasComparison = false;
            if (selectedConsonant && selectedVowel) {
                syllablePlaceholder.classList.add('hidden');
                const cSelected = selectedConsonant.dataset.char;
                const vSelected = selectedVowel.dataset.char;
                
                mainSyllableCharDisplay.textContent = syllableMaps[selectedConsonantActualType]?.[cSelected]?.[vSelected] || 'Lỗi';
                
                let plainSyllableText = '--';
                if (selectedConsonantActualType === 'aspirated') {
                    const cPlain = aspiratedToPlainMap[cSelected];
                    plainSyllableText = syllableMaps.plain?.[cPlain]?.[vSelected] || '--';
                    hasComparison = plainSyllableText !== '--';
                } else if (selectedConsonantActualType === 'tense') {
                    const cPlain = tenseToPlainMap[cSelected];
                    plainSyllableText = syllableMaps.plain?.[cPlain]?.[vSelected] || '--';
                    hasComparison = plainSyllableText !== '--';
                }
                plainComparisonSyllableCharDisplay.textContent = plainSyllableText;
                interactiveSyllableGrid.querySelector('.plain-comparison-column').style.visibility = hasComparison ? 'visible' : 'hidden';

            } else {
                syllablePlaceholder.classList.remove('hidden');
                mainSyllableCharDisplay.textContent = '--';
                plainComparisonSyllableCharDisplay.textContent = '--';
                interactiveSyllableGrid.querySelector('.plain-comparison-column').style.visibility = 'visible'; 
                if (selectedConsonant) mainSyllableCharDisplay.textContent = selectedConsonant.dataset.char + '+?';
                if (selectedVowel && !selectedConsonant) mainSyllableCharDisplay.textContent = '?+' + selectedVowel.dataset.char;
            }
            mainSyllableCharDisplay.classList.add('fade-in');
            if (hasComparison) { 
                 plainComparisonSyllableCharDisplay.classList.add('fade-in');
            }
        }
        
        function generateRandomSingleSyllableInteractive() { 
            if (!mainSyllableCharDisplay || !plainComparisonSyllableCharDisplay || !syllablePlaceholder || !interactiveSyllableGrid) return;

            syllablePlaceholder.classList.add('hidden');
            
            const randomConsonantObj = allConsonantsWithTypes[Math.floor(Math.random() * allConsonantsWithTypes.length)];
            const randomCSelected = randomConsonantObj.char;
            const randomCType = randomConsonantObj.type; 
            const randomVSelected = allVowelsForRandom[Math.floor(Math.random() * allVowelsForRandom.length)];

            mainSyllableCharDisplay.textContent = syllableMaps[randomCType]?.[randomCSelected]?.[randomVSelected] || 'Lỗi';
            let plainComparisonSyllable = '--';
            let currentHasComparison = false;

            if (randomCType === 'aspirated') {
                const cPlain = aspiratedToPlainMap[randomCSelected];
                plainComparisonSyllable = syllableMaps.plain?.[cPlain]?.[randomVSelected] || '--';
                currentHasComparison = plainComparisonSyllable !== '--';
            } else if (randomCType === 'tense') {
                const cPlain = tenseToPlainMap[randomCSelected];
                plainComparisonSyllable = syllableMaps.plain?.[cPlain]?.[randomVSelected] || '--';
                currentHasComparison = plainComparisonSyllable !== '--';
            }
            plainComparisonSyllableCharDisplay.textContent = plainComparisonSyllable;
            interactiveSyllableGrid.querySelector('.plain-comparison-column').style.visibility = currentHasComparison ? 'visible' : 'hidden';

            mainSyllableCharDisplay.classList.remove('fade-in');
            plainComparisonSyllableCharDisplay.classList.remove('fade-in');
            void mainSyllableCharDisplay.offsetWidth;
            mainSyllableCharDisplay.classList.add('fade-in');
            if (currentHasComparison) {
                plainComparisonSyllableCharDisplay.classList.add('fade-in');
            }

            if (selectedConsonant) selectedConsonant.classList.remove('selected');
            if (selectedVowel) selectedVowel.classList.remove('selected');
            selectedConsonant = null;
            selectedVowel = null;
            selectedConsonantActualType = 'plain'; 
        }

        function generateSyllableSequence(params) {
            if (!syllableSequenceDisplay) return;
            syllableSequenceDisplay.classList.remove('fade-in');
            void syllableSequenceDisplay.offsetWidth;

            const { countRange, consonantTypes, vowelGroupKey } = params;
            const syllableCount = Math.floor(Math.random() * (countRange[1] - countRange[0] + 1)) + countRange[0];
            const vowelsForSequence = vowelGroupsForSequence[vowelGroupKey] || vowelGroupsForSequence.all;
            
            let sequence = [];
            for (let i = 0; i < syllableCount; i++) {
                const randomConsonantTypeKey = consonantTypes[Math.floor(Math.random() * consonantTypes.length)];
                const consonantsForType = consonantGroupsForDisplay[randomConsonantTypeKey]; 
                const randomC = consonantsForType[Math.floor(Math.random() * consonantsForType.length)];
                const randomV = vowelsForSequence[Math.floor(Math.random() * vowelsForSequence.length)];
                
                const syllable = syllableMaps[randomConsonantTypeKey]?.[randomC]?.[randomV] || ' ? ';
                sequence.push(syllable);
            }
            syllableSequenceDisplay.textContent = sequence.join(' ');
            syllableSequenceDisplay.classList.add('fade-in');
        }
        
        function displayNextVocabularyWord() {
            if (!vocabWordDisplay || !vocabMeaningDisplay) return;
            currentVocabIndex = Math.floor(Math.random() * vocabulary.length);
            const currentWord = vocabulary[currentVocabIndex];
            vocabWordDisplay.textContent = currentWord.word;
            vocabMeaningDisplay.textContent = currentWord.meaning;
            vocabMeaningDisplay.classList.add('hidden'); 
            if(showMeaningButton) showMeaningButton.textContent = "Xem Nghĩa";
        }

        function toggleVocabMeaning() {
            if (!vocabMeaningDisplay || !showMeaningButton) return;
            vocabMeaningDisplay.classList.toggle('hidden');
            showMeaningButton.textContent = vocabMeaningDisplay.classList.contains('hidden') ? "Xem Nghĩa" : "Ẩn Nghĩa";
        }

        function setActiveExercise(exerciseId) {
            activeExerciseId = exerciseId;
            const exercise = exercises.find(ex => ex.id === exerciseId);
            if (!exercise) return;

            const navButtons = navigationMenu.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.exerciseId === exerciseId);
            });
            
            selectedConsonant = null;
            selectedVowel = null;
            
            renderExerciseUI(exercise);
        }

        exercises.forEach(ex => {
            const button = document.createElement('button');
            button.textContent = ex.title;
            button.classList.add('nav-btn', 'p-3', 'rounded-md', 'text-left', 'w-full', 'bg-white', 'text-blue-700', 'shadow-sm');
            button.dataset.exerciseId = ex.id;
            button.addEventListener('click', () => setActiveExercise(ex.id));
            navigationMenu.appendChild(button);
        });

        setActiveExercise('ex_single_syllable'); 

    </script>
</body>
</html>
